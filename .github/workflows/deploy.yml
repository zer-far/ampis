name: Deploy onion site
on: [push]
jobs:
  deploy_job:
    runs-on: ubuntu-latest
    name: Build and deploy site
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Build
        run: |
          docker run \
          -v ${{ github.workspace }}:/srv/jekyll -v ${{ github.workspace }}/_site:/srv/jekyll/_site \
          jekyll/builder:latest /bin/bash -c "chmod -R 777 /srv/jekyll && jekyll build --destination _prod_site/ --config _config.yml"
      - name: Deploy
        uses: wlixcc/SFTP-Deploy-Action@v1.0
        with:
          username: '${{ secrets.SERVER_USERNAME }}'
          server: '${{ secrets.SERVER_IP }}'
          ssh_private_key: '${{ secrets.SSH_PRIVATE_KEY }}'
          local_path: '${{ secrets.LOCAL_PATH }}'
          remote_path: '${{ secrets.SERVER_PATH }}'
          args: '-o ConnectTimeout=5'
